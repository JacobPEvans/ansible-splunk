---
name: Validate

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  syntax-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.9"

      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          version: "latest"

      - name: Install dependencies
        run: |
          uv pip install --system ansible

      - name: Install Ansible collections
        run: |
          ansible-galaxy collection install -r requirements.yml

      - name: Create mock Terraform inventory for syntax checks
        run: |
          cp inventory/terraform_inventory.json.example inventory/terraform_inventory.json

      - name: Syntax check deploy.yml
        run: |
          ansible-playbook playbooks/deploy.yml --syntax-check

      - name: Syntax check configure_indexes.yml
        run: |
          ansible-playbook playbooks/configure_indexes.yml --syntax-check

      - name: Syntax check validate.yml
        run: |
          ansible-playbook playbooks/validate.yml --syntax-check

      - name: Syntax check site.yml
        run: |
          ansible-playbook playbooks/site.yml --syntax-check
